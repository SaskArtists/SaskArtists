var ContentFlowGlobal={Flows:new Array,AddOns:{},scriptName:"contentflow.js",scriptElement:null,Browser:new function(){this.Opera=!!window.opera,this.IE=!(!document.all||this.Opera),this.IE6=!(!this.IE||void 0!==window.XMLHttpRequest),this.IE8=!(!this.IE||void 0===document.querySelectorAll),this.IE7=!(!this.IE||this.IE6||this.IE8),this.WebKit=!!/WebKit/i.test(navigator.userAgent),this.iPhone=!!/iPhone|iPod/i.test(navigator.userAgent),this.Chrome=!!/Chrome/i.test(navigator.userAgent),this.Safari=!(!/Safari/i.test(navigator.userAgent)||this.Chrome),this.Konqueror="KDE"==navigator.vendor,this.Konqueror4=!(!this.Konqueror||!/native code/.test(document.getElementsByClassName)),this.Gecko=!this.WebKit&&"Gecko"==navigator.product,this.Gecko19=!(!this.Gecko||!Array.reduce)},getAddOnConf:function(t){return this.AddOns[t]?this.AddOns[t].conf:{}},setAddOnConf:function(t,e){this.AddOns[t].setConfig(e)},getScriptElement:function(t){for(var e=new RegExp(t),i=document.getElementsByTagName("script"),n=0;n<i.length;n++)if(i[n].src&&e.test(i[n].src))return i[n];return""},getScriptPath:function(t,e){var i=new RegExp(e+".*");return t.src.replace(i,"")},addScript:function(t){if(this.Browser.IE||this.Browser.WebKit||this.Browser.Konqueror)document.write('<script type="text/javascript" src="'+t+'"><\/script>');else{var e=document.createElement("script");e.src=t,e.setAttribute("type","text/javascript"),document.getElementsByTagName("head")[0].appendChild(e)}},addScripts:function(t,e){for(var i=0;i<filename.length;i++)this.addScript(basepath+e[i])},addStylesheet:function(t){if(this.Browser.Gecko19){var e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("href",t),e.setAttribute("type","text/css"),e.setAttribute("media","screen"),document.getElementsByTagName("head")[0].appendChild(e)}else document.write('<link rel="stylesheet" href="'+t+'" type="text/css" media="screen" />')},addStylesheets:function(t,e){for(var i=0;i<filename.length;i++)this.addStylesheet(basepath+e[i])},initPath:function(){this.scriptElement=this.getScriptElement(this.scriptName),this.scriptElement||(this.scriptName="contentflow_src.js",this.scriptElement=this.getScriptElement(this.scriptName)),this.BaseDir=this.getScriptPath(this.scriptElement,this.scriptName),this.AddOnBaseDir||(this.AddOnBaseDir=this.BaseDir),this.CSSBaseDir||(this.CSSBaseDir=this.BaseDir)},init:function(){if(this.addStylesheet(this.CSSBaseDir+"contentflow.css"),this.addStylesheet(this.CSSBaseDir+"mycontentflow.css"),this.loadAddOns=new Array,this.scriptElement.getAttribute("load"))for(var t=this.loadAddOns=this.scriptElement.getAttribute("load").replace(/\ +/g," ").split(" "),e=0;e<t.length;e++)""!=t[e]&&this.addScript(this.AddOnBaseDir+"ContentFlowAddOn_"+t[e]+".js");var i=this;if(document.addEventListener)if(this.Browser.WebKit)var n=setInterval(function(){/loaded|complete/.test(document.readyState)&&(clearInterval(n),i.onloadInit())},10);else document.addEventListener("DOMContentLoaded",i.onloadInit,!1);else this.Browser.IE&&(document.write("<script id=__ie_cf_onload defer src=javascript:void(0)><\/script>"),document.getElementById("__ie_cf_onload").onreadystatechange=function(){"complete"==this.readyState&&i.onloadInit()});window.addEvent("load",i.onloadInit,!1)},onloadInit:function(){if(!arguments.callee.done){for(var t=0;t<ContentFlowGlobal.loadAddOns.length;t++){var e=ContentFlowGlobal.loadAddOns[t];if(!ContentFlowGlobal.AddOns[e]){var i=ContentFlowGlobal;return void window.setTimeout(i.onloadInit,10)}}if(arguments.callee.done=!0,window.Element&&Element.implement&&document.all&&!window.opera)for(var n in window.CFElement.prototype)if(!window.Element.prototype[n]){var s={};s[n]=window.CFElement.prototype[n],Element.implement(s)}for(t=0;t<ContentFlowGlobal.Flows.length;t++)ContentFlowGlobal.Flows[t].init();var o=document.getElementsByTagName("div");t:for(t=0;t<o.length;t++)if(o[t].className.match(/\bContentFlow\b/)){for(var h=0;h<ContentFlowGlobal.Flows.length;h++)if(o[t]==ContentFlowGlobal.Flows[h].Container)continue t;new ContentFlow(o[t],{},!1).init()}}}};ContentFlowGlobal.initPath();var ContentFlowAddOn=function(t,e,i){(void 0!==i&&0==i||(ContentFlowGlobal.AddOns[t]=this),this.name=t,e||(e={}),this.methods=e,this.conf={},this.methods.conf&&(this.setConfig(this.methods.conf),delete this.methods.conf),this.scriptpath=ContentFlowGlobal.AddOnBaseDir,e.init)&&e.init.bind(this)(this)};ContentFlowAddOn.prototype={Browser:ContentFlowGlobal.Browser,addScript:ContentFlowGlobal.addScript,addScripts:ContentFlowGlobal.addScripts,addStylesheet:function(t){t||(t=this.scriptpath+"ContentFlowAddOn_"+this.name+".css"),ContentFlowGlobal.addStylesheet(t)},addStylesheets:ContentFlowGlobal.addStylesheets,setConfig:function(t){for(var e in t)this.conf[e]=t[e]},_init:function(t){this.methods.ContentFlowConf&&t.setConfig(this.methods.ContentFlowConf)}};var ContentFlowGUIElement=function(t,e){return e.setDimensions=function(){this.dimensions=this.getDimensions(),this.center={x:this.dimensions.width/2,y:this.dimensions.height/2},this.position=this.findPos()},e.addObserver=function(e,i){var n=this.eventMethod=i.bind(t);this.observedEvent=e,this.addEvent(e,n,!1)},e.makeDraggable=function(t,e,i){this.stopDrag=function(e){if(!e)e=window.event;if(this.Browser.iPhone){if(window.removeEvent("touchemove",t,!1),!this.ontochmove){var n=e.target;n.firstChild&&(n=n.firstChild);var s=document.createEvent("MouseEvents");s.initEvent("click",!0,!0),n.dispatchEvent(s)}}else window.removeEvent("mousemove",t,!1);i(e)}.bind(this),this.initDrag=function(t){if(!t)t=window.event;var i=t;t.touches&&(i=t.touches[0]),this.mouseX=i.clientX,this.mouseY=i.clientY,e(t)}.bind(this),this.startDrag=function(e){if(!e)e=window.event;var i=this.stopDrag;if(this.Browser.iPhone){var n=this;n.ontouchmove=!1,window.addEvent("touchmove",function(e){n.ontouchmove=!0,t(e)},!1),e.preventDefault(),window.addEvent("touchend",i,!1)}else window.addEvent("mousemove",t,!1),window.addEvent("mouseup",i,!1);e.preventDefault&&e.preventDefault()}.bind(this);var n=this.startDrag;this.Browser.iPhone?this.addEventListener("touchstart",n,!1):this.addEvent("mousedown",n,!1)},e.Browser=ContentFlowGlobal.Browser,$CF(e).setDimensions(),e},ContentFlowItem=function(t,e,i){if(this.CFobj=t,this._activeElement=t.conf.activeElement,this.pre=null,this.next=null,this.clickItem=function(t){if(!t)t=window.event;var e=t.target?t.target:t.srcElement,i=e.itemIndex?e.itemIndex:e.parentNode.itemIndex,n=this.items[i];this._activeItem==n?this.conf.onclickActiveItem(n):0!=this.conf.onclickInactiveItem(n)&&this.moveToIndex(i)}.bind(t),this.setIndex=function(t){this.index=t,this.element.itemIndex=t},this.getIndex=function(){return this.index},"IMG"==$CF(e).nodeName){var n=document.createElement("div");n.className="item";var s=e.parentNode.replaceChild(n,e);if(s.className="content",n.appendChild(s),e.title){var o=document.createElement("div");o.className="caption",o.innerHTML=e.title,n.appendChild(o)}e=n}if(this.element=$CF(e),this.item=e,void 0!==i&&this.setIndex(i),this.content=this.element.getChildrenByClassName("content")[0],this.caption=this.element.getChildrenByClassName("caption")[0],this.label=this.element.getChildrenByClassName("label")[0],"IMG"==this.content.nodeName){t._imagesToLoad++;var h=function(){t._imagesToLoad--,this.image=this.content,this.setImageFormat(this.image),t.conf.reflectionHeight>0&&this.addReflection(),this.initClick(),t._addItemCueProcess(!0)}.bind(this);if(this.content.complete&&this.content.width>0)window.setTimeout(h,100);else if(this.Browser.IE&&!this.content.onload)var r=this,a=window.setInterval(function(){r.content.complete&&r.content.width>0&&(window.clearInterval(a),h())},10);else this.content.onload=window.setTimeout(h,100)}else this.initClick(),t._addItemCueProcess(!0)};ContentFlowItem.prototype={Browser:ContentFlowGlobal.Browser,makeActive:function(){this.element.addClassName("active"),this.CFobj.conf.onMakeActive(this)},makeInactive:function(){this.element.removeClassName("active"),this.CFobj.conf.onMakeInactive(this)},initClick:function(){var t=this.clickItem;this[this._activeElement].addEvent("click",t,!1)},setImageFormat:function(t){(this.Browser.IE6||this.Browser.IE7)&&(t.style.width="auto"),t.origProportion=t.width/t.height,t.setAttribute("origProportion",t.width/t.height),(this.Browser.IE6||this.Browser.IE7)&&(t.style.width=""),t.origProportion<=1?t.addClassName("portray"):t.addClassName("landscape")},addReflection:function(){var t,e=this.CFobj,i=this.content;if(this.Browser.IE){var n="progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";if(e._reflectionColorRGB){if("transparent"==e.conf.reflectionColor){var s=t=this.reflection=document.createElement("img");t.src=i.src}else{t=this.reflection=document.createElement("div"),(s=document.createElement("img")).src=i.src,t.width=s.width,t.height=s.height,s.style.width="100%",s.style.height="100%";var o=e._reflectionColorRGB;t.style.backgroundColor="#"+o.hR+o.hG+o.hB,t.appendChild(s)}n+=" progid:DXImageTransform.Microsoft.Alpha(opacity=0, finishOpacity=50, style=1, finishX=0, startY="+100*e.conf.reflectionHeight+" finishY=0)"}else{s=t=this.reflection=document.createElement("img");t.src=i.src}n+=" progid:DXImageTransform.Microsoft.Matrix(M11=1, M12=0, M21=0, M22="+1/e.conf.reflectionHeight+")",ContentFlowGlobal.Browser.IE6&&i.src.match(/\.png$/)&&(i.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+i.src+"', sizingMethod=scale )",i.filterString="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+i.src+"', sizingMethod=scale )",n+=" progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+i.src+"', sizingMethod=scale )",i.origSrc=i.src,i.src="img/blank.gif",s.src="img/blank.gif"),t.filterString=n,s.style.filter=n}else{if(e._reflectionWithinImage)var h=this.canvas=$CF(document.createElement("canvas"));else h=t=this.reflection=document.createElement("canvas");if(h.getContext){if(e._reflectionWithinImage)for(var r=0;r<i.attributes.length;r++)h.setAttributeNode(i.attributes[r].cloneNode(!0));var a=h.getContext("2d"),l=e.maxHeight,c=e._scaleImageSize(this,{width:l,height:l},l),d=c.width,m=c.height;if(e._reflectionWithinImage?(h.width=d,h.height=m,this.setImageFormat(h),h.height=m*(1+e.conf.reflectionHeight+e.conf.reflectionGap)):(h.width=d,h.height=m*e.conf.reflectionHeight),a.save(),e._reflectionWithinImage&&a.drawImage(i,0,0,d,m),e._reflectionWithinImage)var f=m*(1+e.conf.reflectionGap/2)*2;else f=i.height;if(f-=1,a.translate(0,f),a.scale(1,-1),a.drawImage(i,0,0,d,m),a.restore(),e._reflectionColorRGB){var g=a.createLinearGradient(0,0,0,h.height),u=[0,.5,1];"transparent"==e._reflectionColor&&(a.globalCompositeOperation="destination-in",u=[1,.5,0]);var v=e._reflectionColorRGB.iR,p=e._reflectionColorRGB.iG,w=e._reflectionColorRGB.iB;e._reflectionWithinImage?(g.addColorStop(0,"rgba("+v+","+p+","+w+","+u[0]+")"),g.addColorStop(m/h.height,"rgba("+v+","+p+","+w+","+u[0]+")"),g.addColorStop(m/h.height,"rgba("+v+","+p+","+w+","+u[1]+")")):g.addColorStop(0,"rgba("+v+","+p+","+w+","+u[1]+")"),g.addColorStop(1,"rgba("+v+","+p+","+w+","+u[2]+")"),a.fillStyle=g,a.fillRect(0,0,h.width,h.height)}e._reflectionWithinImage&&(i.parentNode.replaceChild(h,i),this.content=h,this.origContent=h,delete this.image)}else e._reflectionWithinImage=!1,delete this.reflection}t&&(t.className="reflection",this.element.appendChild(t),this.caption&&this.element.appendChild(this.caption))}};var ContentFlow=function(t,e){if(!t)throw"ContentFlow ERROR: No flow container node or id given";ContentFlowGlobal.Flows.push(this),this.Container=t,this._userConf=e||{},this.conf={},this._loadedAddOns=new Array};if(ContentFlow.prototype={_imagesToLoad:0,_activeItem:0,_currentPosition:0,_targetPosition:0,_stepLock:!1,_millisecondsPerStep:40,_reflectionWithinImage:!0,Browser:ContentFlowGlobal.Browser,_defaultConf:{useAddOns:"all",biggestItemPos:0,loadingTimeout:3e4,activeElement:"content",maxItemHeight:0,scaleFactor:1,scaleFactorLandscape:1.33,scaleFactorPortrait:1,fixItemSize:!1,relativeItemPosition:"top center",circularFlow:!0,verticalFlow:!1,visibleItems:-1,endOpacity:1,startItem:"center",scrollInFrom:"pre",flowSpeedFactor:1,flowDragFriction:1,scrollWheelSpeed:1,keys:{13:function(){this.conf.onclickActiveItem(this._activeItem)},37:function(){this.moveTo("pre")},38:function(){this.moveTo("visibleNext")},39:function(){this.moveTo("next")},40:function(){this.moveTo("visiblePre")}},reflectionColor:"transparent",reflectionHeight:.5,reflectionGap:0,onInit:function(){},onclickInactiveItem:function(t){},onclickActiveItem:function(t){var e,i;(e=t.content.getAttribute("href"))?i=t.content.getAttribute("target"):(e=t.element.getAttribute("href"))?i=t.element.getAttribute("target"):(e=t.content.getAttribute("src"))&&(i=t.content.getAttribute("target")),e&&(i?window.open(e,i).focus():window.location.href=e)},onMakeInactive:function(t){},onMakeActive:function(t){},onReachTarget:function(t){},onMoveTo:function(t){},onDrawItem:function(t){},onclickPreButton:function(t){return this.moveToIndex("pre"),Event.stop(t)},onclickNextButton:function(t){return this.moveToIndex("next"),Event.stop(t)},calcStepWidth:function(t){var e=this.conf.visibleItems,i=this.items.length;if(i=0==i?1:i,Math.abs(t)>e)if(t>0)var n=t-e;else n=t+e;else if(e>=this.items.length)n=t/i;else n=t*(e/i);return n},calcSize:function(t){var e=t.relativePosition,i=1/(Math.abs(e)+1);return{width:i,height:i}},calcCoordinates:function(t){var e=t.relativePosition,i=this.conf.visibleItems,n=1-1/Math.exp(.75*Math.abs(e));return{x:t.side*i/(i+1)*n,y:1}},calcZIndex:function(t){return-Math.abs(t.relativePositionNormed)},calcFontSize:function(t){return t.size.height},calcOpacity:function(t){return Math.max(1-(1-this.conf.endOpacity)*Math.sqrt(Math.abs(t.relativePositionNormed)),this.conf.endOpacity)}},_checkIndex:function(t){return t=Math.max(t,0),t=Math.min(t,this.itemsLastIndex)},_setLastIndex:function(){this.itemsLastIndex=this.items.length-1},_getItemByIndex:function(t){return this.items[this._checkIndex(t)]},_getItemByPosition:function(t){return this._getItemByIndex(this._getIndexByPosition(t))},_getPositionByIndex:function(t){if(!this.conf.circularFlow)return this._checkIndex(t);var e=t-this._getIndexByPosition(this._currentPosition);return Math.abs(e)>e+this.items.length?e+=this.items.length:Math.abs(e)>Math.abs(e-this.items.length)&&(e-=this.items.length),this._currentPosition+e},_getIndexByPosition:function(t){if(t<0)var e=0;else e=1;var i=(Math.round(t)+e)%this.items.length;return i>0?i-=e:i<0?i+=this.items.length-e:i=t<0?0:this.items.length-1,i},_getIndexByKeyWord:function(t,e,i){if(e)var n=e;else if(this._activeItem)n=this._activeItem.index;else n=0;if(isNaN(t))switch(t){case"first":case"start":n=0;break;case"last":case"end":n=this.itemsLastIndex;break;case"middle":case"center":n=Math.round(this.itemsLastIndex/2);break;case"right":case"next":n+=1;break;case"left":case"pre":case"previous":n-=1;break;case"visible":case"visiblePre":case"visibleLeft":n-=this.conf.visibleItems;break;case"visibleNext":case"visibleRight":n+=this.conf.visibleItems;break;default:n=n}else n=t;return 0!=i&&(n=this._checkIndex(n)),n},_setCaptionLabel:function(t){this.Position&&!this.Slider.locked&&this.Position.setLabel(t),this._setGlobalCaption()},getAddOnConf:function(t){return ContentFlowGlobal.getAddOnConf(t)},setAddOnConf:function(t,e){ContentFlowGlobal.setAddOnConf(t,e)},init:function(){this.isInit||this._init()},setConfig:function(t){if(t){var e=this._defaultConf;for(var i in t)if("undefined"!=e[i])switch(i){case"scrollInFrom":case"startItem":"number"!=typeof t[i]&&"string"!=typeof t[i]||(this.conf[i]=t[i]);break;default:e[i],t[i],"function"==typeof t[i]?this.conf[i]=t[i].bind(this):this.conf[i]=t[i]}switch(this.conf.reflectionColor){case this.conf.reflectionColor.search(/#[0-9a-fA-F]{6}/)>=0?this.conf.reflectionColor:this.conf.reflectionColor+"x":this._reflectionColorRGB={hR:this.conf.reflectionColor.slice(1,3),hG:this.conf.reflectionColor.slice(3,5),hB:this.conf.reflectionColor.slice(5,7),iR:parseInt(this.conf.reflectionColor.slice(1,3),16),iG:parseInt(this.conf.reflectionColor.slice(3,5),16),iB:parseInt(this.conf.reflectionColor.slice(5,7),16)};break;case"none":case"transparent":default:this._reflectionColor="transparent",this._reflectionColorRGB={hR:0,hG:0,hB:0,iR:0,iG:0,iB:0}}if(this.items&&(this.conf.visibleItems<0&&(this.conf.visibleItems=Math.round(Math.sqrt(this.items.length))),this.conf.visibleItems=Math.min(this.conf.visibleItems,this.items.length-1)),this.conf.relativeItemPosition){var n,s={x:{left:function(t){return-1},center:function(t){return 0},right:function(t){return 1}},y:{top:function(t){return-1},center:function(t){return 0},bottom:function(t){return 1}}},o=this.conf.relativeItemPosition,h=null;n=(o=o.replace(/above/,"top").replace(/below/,"bottom")).match(/left|right/),h=o.match(/top|bottom/),c=o.match(/center/),n||(n=(c,"center")),h||(h=c?"center":"top");var r=s.x[n],a=s.y[h];this.conf.calcRelativeItemPosition=function(t){return{x:r(t.size),y:a(t.size)}},this.conf.relativeItemPosition=null}this._reflectionType&&"clientside"!=this._reflectionType&&(this.conf.reflectionHeight=0)}},getItem:function(t){return this.items[this._checkIndex(Math.round(t))]},getActiveItem:function(){return this._activeItem},getNumberOfItems:function(){return this.items.length},resize:function(){this._initSizes(),this._initStep()},moveToPosition:function(t,e){this.conf.circularFlow||(t=this._checkIndex(t)),this._targetPosition=t,this.conf.onMoveTo(this._getItemByPosition(t)),this._initStep(!1,e)},moveToIndex:function(t){this._targetPosition=Math.round(this._getPositionByIndex(this._getIndexByKeyWord(t,this._activeItem.index,!this.conf.circularFlow))),this.conf.onMoveTo(this._getItemByPosition(this._targetPosition)),this._initStep()},moveToItem:function(t){var e;e=t.itemIndex?t.itemIndex:t.index,this.moveToIndex(e)},moveTo:function(t){"object"==typeof t?this.moveToItem(t):isNaN(t)||t==Math.floor(t)&&t<this.items.length?this.moveToIndex(t):this.moveToPosition(t)},_addItemCue:[],_addItemCueProcess:function(t){var e=this._addItemCue;if(1==t&&e.shift(),e.length>0&&!e[0].p){e[0].p=!0;var i=this,n=e.length>5?1:40;window.setTimeout(function(){i._addItem(e[0].el,e[0].i)},n)}},addItem:function(t,e){this._addItemCue.push({el:t,i:e,p:!1}),1==this._addItemCue.length&&this._addItemCueProcess()},_addItem:function(t,e){if("string"==typeof e)switch(e){case"first":case"start":e=0;break;case"last":case"end":e=isNaN(this.itemsLastIndex)?0:this.itemsLastIndex,e+=1;break;default:e=this._getIndexByKeyWord(e)}e=Math.max(e,0),e=Math.min(e,this.itemsLastIndex+1),e=isNaN(e)?0:e,this.Flow||this.init(),this.Flow.appendChild(t);var i=new ContentFlowItem(this,t,e);0==this.items.length?(this.resize(),this.conf.circularFlow&&(i.pre=i,i.next=i)):(e==this.itemsLastIndex+1?(i.pre=this.items[this.itemsLastIndex],i.next=i.pre.next):(i.next=this.items[e],i.pre=i.next.pre),i.pre&&(i.pre.next=i),i.next&&(i.next.pre=i)),this.items.splice(e,0,i);for(var n=e;n<this.items.length;n++)this.items[n].setIndex(n);this._setLastIndex(),this.conf.origVisibleItems<0&&(this.conf.visibleItems=Math.round(Math.sqrt(this.items.length))),this.conf.visibleItems=Math.min(this.conf.visibleItems,this.items.length-1),Math.round(this._getPositionByIndex(e))<=Math.round(this._targetPosition)&&(this._targetPosition++,this.conf.circularFlow||(this._targetPosition=Math.min(this._targetPosition,this.itemsLastIndex))),this._getPositionByIndex(e)<=this._currentPosition&&(this._currentPosition++,this.conf.circularFlow||(this._currentPosition=Math.min(this._currentPosition,this.itemsLastIndex)));var s=this;return window.setTimeout(function(){1==s.items.length?(s._currentPosition=-.01,s._targetPosition=0,s.resize()):s._initStep()},100),e},rmItem:function(t){if("undefined"==t&&(t=this._activeItem.index),t=this._getIndexByKeyWord(t),!this.items[t])return null;var e=this.items[t];e.pre&&(e.pre.next=e.next),e.next&&(e.next.pre=e.pre),this.items.splice(t,1);for(var i=t;i<this.items.length;i++)this.items[i].setIndex(i);this._setLastIndex(),Math.round(this._getPositionByIndex(t))<Math.round(this._targetPosition)&&(this._targetPosition--,this.conf.circularFlow||(this._targetPosition=this._checkIndex(this._targetPosition))),this._getPositionByIndex(t)<this._currentPosition&&(this._currentPosition--,this.conf.circularFlow||(this._currentPosition=this._checkIndex(this._currentPosition))),this._activeItem=this._getItemByPosition(this._currentPosition);var n=e.element.parentNode.removeChild(e.element),s=this;return window.setTimeout(function(){s._initStep()},10),n},_init:function(){if("string"==typeof this.Container){var t=document.getElementById(this.Container);if(!t)throw"ContentFlow ERROR: No element with id '"+this.Container+"' found!";this.Container=t}$CF(this.Container).addClassName("ContentFlow");var e=$CF(this.Container).getChildrenByClassName("flow")[0];if(!e)throw"ContentFlow ERROR: No element with class'flow' found!";this.Flow=new ContentFlowGUIElement(this,e);var i=this.Container.getChildrenByClassName("scrollbar")[0];if(i){this.Scrollbar=new ContentFlowGUIElement(this,i);var n=this.Scrollbar.getChildrenByClassName("slider")[0];if(n){this.Slider=new ContentFlowGUIElement(this,n);var s=this.Slider.getChildrenByClassName("position")[0];s&&(this.Position=new ContentFlowGUIElement(this,s))}}this.setConfig(this._defaultConf),this._initAddOns(),this.setConfig(this._userConf),this._initSizes();var o=this.Flow.getChildrenByClassName("item");this.items=new Array;for(var h=0;h<o.length;h++){var r=this.items[h]=new ContentFlowItem(this,o[h],h);h>0&&(r.pre=this.items[h-1],r.pre.next=r)}if(this._setLastIndex(),this.conf.circularFlow&&this.items.length>0){var a=this.items[0];a.pre=this.items[this.items.length-1],a.pre.next=a}this._initGUI(),"content"!=this._activeElement&&(this._activeElement="element"),this.conf.origVisibleItems=this.conf.visibleItems,this.conf.visibleItems<0&&(this.conf.visibleItems=Math.round(Math.sqrt(this.items.length))),this.conf.visibleItems=Math.min(this.conf.visibleItems,this.items.length-1),this._targetPosition=this._getIndexByKeyWord(this.conf.startItem,0);var l=this._getIndexByKeyWord(this.conf.scrollInFrom,this._targetPosition);switch(this.conf.scrollInFrom){case"next":case"right":l-=.5;break;case"pre":case"previous":case"left":l+=.5}this._currentPosition=l;var c=new Date,d=this,m=window.setInterval(function(){if(0==d._imagesToLoad||new Date-c>d._loadingTimeout){clearInterval(m),d._activeItem=d.getItem(d._currentPosition),d._activeItem&&(d._activeItem.makeActive(),d._setCaptionLabel(d._activeItem.index)),d.Flow.style.visibility="visible",d.loadIndicator&&(d.loadIndicator.style.display="none"),d.Scrollbar&&(d.Scrollbar.style.visibility="visible"),d.resize();for(var t=0;t<d._loadedAddOns.length;t++){var e=ContentFlowGlobal.AddOns[d._loadedAddOns[t]];e.methods.afterContentFlowInit&&e.methods.afterContentFlowInit(d)}d.conf.onInit()}},10);this.isInit=!0},_initAddOns:function(){var t=[];this._userConf.useAddOns?"string"==typeof this._userConf.useAddOns?t=this._userConf.useAddOns.split(" "):"array"==typeof this._userConf.useAddOns&&(t=this._userConf.useAddOns):t=this.Container.getAttribute("useAddOns")?this.Container.getAttribute("useAddOns").split(" "):this.conf.useAddOns.split(" ");for(var e=0;e<t.length;e++){if("none"==t[e]){t=new Array;break}if("all"==t[e]){for(var i in t=new Array,ContentFlowGlobal.AddOns)t.push(i);break}}for(e=0;e<t.length;e++){(i=ContentFlowGlobal.AddOns[t[e]])&&(this._loadedAddOns.push(t[e]),i._init(this),this.Container.addClassName("ContentFlowAddOn_"+i.name),i.methods.onloadInit&&i.methods.onloadInit(this))}},_initGUI:function(){var t=this.resize.bind(this);window.addEvent("resize",t,!1);for(var e=this.Container.getElementsByTagName("div"),i=0;i<e.length;i++)if($CF(e[i]).hasClassName("preButton")){var n=e[i],s=this.conf.onclickPreButton;n.addEvent("click",s,!1)}else if(e[i].hasClassName("nextButton")){var o=e[i];s=this.conf.onclickNextButton;o.addEvent("click",s,!1)}if(0!=this.conf.scrollWheelSpeed){var h=this._wheel.bind(this);window.addEventListener&&this.Container.addEventListener("DOMMouseScroll",h,!1),this.Container.onmousewheel=h}var r=this._keyStroke.bind(this);if(this.conf.keys&&!this.Browser.iPhone)if(document.addEventListener)if(this.Browser.Opera)this.Container.addEvent("keydown",r);else{var a=document.createElement("div");a.addClassName("mouseoverCheckElement"),this.Container.appendChild(a),this.Browser.WebKit?document.body.addEvent("keydown",function(t){a.offsetLeft>0&&r(t)}):window.addEvent("keydown",function(t){a.offsetLeft>0&&r(t)})}else this.Container.onkeydown=r;if(this.conf.flowDragFriction>0){var l=function(t){var e=t;t.touches&&(e=t.touches[0]);var i=e.clientX,n=e.clientY;if(this.conf.verticalFlow)var s=n-this.Flow.mouseY,o=this.Flow.dimensions.height;else s=i-this.Flow.mouseX,o=this.Flow.dimensions.width;var h=s/o*(2*this.conf.visibleItems+1),r=this._currentPosition-2*h*this.conf.visibleItems/this.conf.flowDragFriction;this.Flow.mouseX=i,this.Flow.mouseY=n,this.moveToPosition(r,!0)}.bind(this),c=function(){},d=function(t){var e=Math.round(this._targetPosition);Math.abs(e-this._currentPosition)>.001&&this.moveToPosition(e)}.bind(this);this.Flow.makeDraggable(l,c,d)}if(this.Scrollbar){var m=function(t){if(!t)t=window.event;if(this.Scrollbar.clickLocked)this.Scrollbar.clickLocked=!1;else{var e=t.clientX-this.Scrollbar.position.left,i=Math.round(e/this.Scrollbar.dimensions.width*this.itemsLastIndex);this.moveToIndex(i)}}.bind(this);this.Scrollbar.addObserver("click",m)}if(this.Slider){if(this.Browser.IE6){var f=document.createElement("div");f.className="virtualSlider",this.Slider.appendChild(f)}this.Slider.setPosition=function(t){if(t=t-Math.floor(t)+this._getIndexByPosition(Math.floor(t)),Math.round(t)<0?t=this.itemsLastIndex:t<=0?t=0:Math.round(t)>this.itemsLastIndex?t=0:t>=this.itemsLastIndex&&(t=this.itemsLastIndex),this.items.length>1)var e=t/this.itemsLastIndex*this.Scrollbar.dimensions.width;else e=.5*this.Scrollbar.dimensions.width;this.Slider.style.left=e-this.Slider.center.x+"px",this.Slider.style.top=this.Scrollbar.center.y-this.Slider.center.y+"px"}.bind(this);c=function(t){this.Scrollbar.clickLocked=!0}.bind(this),l=function(t){var e=t;t.touches&&(e=t.touches[0]);var i=this._checkIndex((e.clientX-this.Scrollbar.position.left)/this.Scrollbar.dimensions.width*this.itemsLastIndex);this._targetPosition=this._getPositionByIndex(i),this.Slider.setPosition(i),this.Position&&this.Position.setLabel(i),this._initStep(!0,!0)}.bind(this),d=function(t){this._targetPosition=Math.round(this._targetPosition),this.conf.onMoveTo(this._getItemByPosition(this._targetPosition)),this._initStep(!0)}.bind(this);this.Slider.makeDraggable(l,c,d)}this.Position&&(this.Position.setLabel=function(t){t=this._checkIndex(Math.round(t)),this.items&&this.items[t].label?this.Position.innerHTML=this.items[t].label.innerHTML:this.Position.innerHTML=t+1}.bind(this)),this.globalCaption=this.Container.getChildrenByClassName("globalCaption")[0],this.loadIndicator=this.Container.getChildrenByClassName("loadIndicator")[0]},_initSizes:function(t){this._initMaxHeight();var e=this._initScrollbarSize();if(!this.conf.verticalFlow&&this.Container.style.height&&"auto"!=this.Container.style.height&&(this.maxHeight-=e),this._activeItem){var i=this._findBiggestItem(),n=this.Flow.findPos();this.conf.verticalFlow?(this.Flow.style.width=i.width.width+"px",this.Flow.style.height=3*i.width.width*(1+this.conf.reflectionHeight+this.conf.reflectionGap)+"px"):this.Flow.style.height=i.height.height+(i.height.top-n.top)+"px";var s=this.conf.verticalFlow?i.width.width:i.height.height,o=s/(1+this.conf.reflectionHeight+this.conf.reflectionGap);this.Flow.style.marginBottom=-(s-o)+"px",this.Flow.dimensions=this.Flow.getDimensions(),this.Browser.IE6||this.conf.verticalFlow&&this.Container.clientWidth<this.Flow.dimensions.width||this.Container.clientHeight<this.Flow.dimensions.height&&(this.Container.style.height=this.Flow.dimensions.height+"px"),this.conf.verticalFlow?this.Flow.center={x:this.Flow.dimensions.height/2,y:i.width.width/2}:this.Flow.center={x:this.Flow.dimensions.width/2,y:i.height.height/2}}},_initScrollbarSize:function(){var t,e,i;if(t=this.Scrollbar){t.setDimensions();var n=t.dimensions.height;if((e=this.Slider)&&(e.setDimensions(),n+=e.dimensions.height,i=this.Position)){var s=i.innerHTML,o=maxW=0;if(i.style.width="auto",this.items)for(var h=0;h<this.items.length;h++){var r=this.items[h];r.label?i.innerHTML=r.label.innerHTML:i.innerHTML=r.index;var a=i.clientHeight,l=i.clientWidth;a>o&&(o=a),l>maxW&&(maxW=l)}else i.innerHTML="&nbsp;",o=i.clientHeight,maxW=i.clientWidth;i.innerHTML=s,i.setDimensions(),i.style.width=maxW+"px",i.style.left=(e.dimensions.width-maxW)/2+"px";var c=i.position.top-e.position.top;c>0?(c+=-t.dimensions.height+o,t.style.marginBottom=c+"px"):(c*=-1,t.style.marginTop=c+"px"),n+=c}}else n=0;return n},_initMaxHeight:function(){if(this.conf.verticalFlow)var t=screen.width/screen.height,e=this.Container.style.width,i=this.Container.clientWidth,n=this.Flow.style.width,s=this.Flow.clientWidth,o=this.Flow.clientHeight;else t=screen.height/screen.width,e=this.Container.style.height,i=this.Container.clientHeight,n=this.Flow.style.height,s=this.Flow.clientHeight,o=this.Flow.clientWidth;if(this.ContainerOldDim&&(e=this.ContainerOldDim),this.FlowOldDim&&(n=this.FlowOldDim),this.ContainerOldDim="auto",this.FlowOldDim="auto",this.conf.maxItemHeight<=0){if(this.maxHeight=o/3*t/1*this.conf.scaleFactor,this.conf.verticalFlow&&(0==this.maxHeight||this.maxHeight>s)&&(this.maxHeight=s),e&&"auto"!=e){var h=this.conf.verticalFlow?0:this.conf.reflectionGap,r=this.conf.verticalFlow?0:this.conf.reflectionHeight;this.maxHeight=i/(this.conf.scaleFactor*(1+r+h)),this.ContainerOldDim=e}else if(n&&"auto"!=n){h=this.conf.verticalFlow?0:this.conf.reflectionGap;this.maxHeight=s/(this.conf.scaleFactor*(1+this.conf.reflectionHeight+h)),this.FlowOldDim=n}}else this.maxHeight=this.conf.maxItemHeight},_findBiggestItem:function(){var t=this._activeItem,e=(t.pre,t.next,maxFlowSize={width:{width:0,left:0,height:0,top:0,item:null,rI:0},height:{width:0,left:0,height:0,top:0,item:null,rI:0}}),i=function(t,i){var n=t.element;n.style.display="block";var s=n.findPos(),o=n.clientHeight,h=n.clientWidth;o+s.top>=e.height.height+e.height.top&&(e.height.height=o,e.height.top=s.top,e.height.item=t,e.height.rI=i),h+s.left>=e.width.width+e.width.left&&(e.width.width=h,e.width.left=s.left,e.width.item=t,e.width.rI=i),n.style.display="none"},n=this._currentPosition;this._currentPosition=this.conf.visibleItems+1;for(var s=-this.conf.visibleItems;s<=this.conf.visibleItems;s++)t.element.style.display="none",this._positionItem(t,s),i(t,s);var o=e.height.rI;for(s=0;s<this.items.length;s++){var h=this.items[s];h.element.style.display="none",this._positionItem(h,o),i(h,o)}return this._currentPosition=n,e},_keyStroke:function(t){if(!t)t=window.event;if(t.which)var e=t.which;else if(t.keyCode)e=t.keyCode;return!this.conf.keys[e]||(this.conf.keys[e].bind(this)(),Event.stop(t))},_wheel:function(t){if(!t)t=window.event;var e=0;if(t.wheelDelta?e=t.wheelDelta/120:t.detail&&(e=-t.detail/3),e){var i=this._targetPosition;e<0?i+=1*this.conf.scrollWheelSpeed:i-=1*this.conf.scrollWheelSpeed,this.moveToPosition(Math.round(i))}return Event.stop(t)},_setGlobalCaption:function(){this.globalCaption&&(this.globalCaption.innerHTML="",this._activeItem&&this._activeItem.caption&&this.globalCaption.appendChild(this._activeItem.caption.cloneNode(!0)))},_initStep:function(t,e){this.Slider&&(this.Slider.locked=!!t),this._holdPos=1==e,this._stepLock||(this._stepLock=!0,this._step())},_step:function(){var t=this._targetPosition-this._currentPosition,e=Math.abs(t);if(e>.001){this._currentPosition+=this.conf.flowSpeedFactor*this.conf.calcStepWidth(t,e,this.items.length,this.conf.visibleItems);var i=this.items[this._getIndexByPosition(this._currentPosition)];i&&i!=this._activeItem&&(this._activeItem&&this._activeItem.makeInactive(),this._activeItem=i,this._activeItem.makeActive(),this._setCaptionLabel(this._activeItem.index),Math.abs(this._targetPosition-this._currentPosition)<=.5&&this.conf.onReachTarget(this._activeItem)),this._positionItems();var n=this._step.bind(this);window.setTimeout(n,this._millisecondsPerStep)}else this._holdPos?this._stepLock=!1:(this.Slider&&(this.Slider.locked=!1),this._currentPosition=Math.round(this._currentPosition),this.Position&&!this.Slider.locked&&this._activeItem&&this._setCaptionLabel(this._activeItem.index),this._positionItems(),this._stepLock=!1);this.Slider&&!this.Slider.locked&&this.Slider.setPosition(this._currentPosition)},_positionItems:function(){if(this._lastStart)for(var t=this._lastStart;t&&(t.element.style.display="none",(t=t.next)!=this._lastStart)&&(!t||t.pre!=this._lastEnd););else this._lastStart=this._activeItem;if(this._activeItem){var e=this._activeItem,i=e.pre,n=e.next;this._positionItem(e,0);for(var s=1;s<=this.conf.visibleItems&&2*s<this.items.length;s++)i&&(this._positionItem(i,-s),this._lastStart=i,i=i.pre),n&&(this._positionItem(n,s),this._lastEnd=n,n=n.next)}},_positionItem:function(t,e){var i=this.conf,n=i.verticalFlow,s=t.element.style,o=t.position=this._currentPosition+e,h=t.relativePosition=Math.round(o)-this._currentPosition,r=(t.relativePositionNormed=i.visibleItems>0?h/i.visibleItems:0,h<0?-1:1);r*=0==h?0:1,t.side=r;var a=i.calcSize(t);a.height=Math.max(a.height,0),a.width=Math.max(a.width,0),t.content.origProportion&&(a=this._scaleImageSize(t,a)),t.size=a;var l=t.coordinates=i.calcCoordinates(t),c=t.relativeItemPosition=i.calcRelativeItemPosition(t),d=t.zIndex=i.calcZIndex(t),m=t.fontSize=i.calcFontSize(t);t.opacity=i.calcOpacity(t);a.height*=this.maxHeight,a.width*=this.maxHeight;var f=n?a.height:a.width,g=n?a.width:a.height,u=this.Flow.center.x*(1+l.x)+(c.x-1)*f/2,v=this.maxHeight/2*(1+l.y)+(c.y-1)*g/2;s.left=(n?v:u)+"px",s.top=(n?u:v)+"px",this._setItemSize(t,a),1!=i.endOpacity&&this._setItemOpacity(t),this.Browser.IE||(s.fontSize=100*m+"%"),s.zIndex=32768+Math.round(d*this.items.length),i.onDrawItem(t),s.visibility="visible",s.display="block"},_scaleImageSize:function(t,e,i){var n=this.conf.scaleFactorLandscape,s=this.conf.scaleFactorPortrait,o=this.conf.verticalFlow,h=t.content.origProportion,r=e.width,a=e.height,l=t.content;if(o?h<=1?("max"!=n&&1!=n&&(a*=n,r=Math.min(a*h,i||1)),a=r/h):h>1&&("max"==s?a=i||1:1!=s?(r*=s,a=Math.min(r/h,i||1)):a=r/h,r=a*h):h>1?("max"!=n&&1!=n&&(r*=n,a=Math.min(r/h,i||1)),r=a*h):h<=1&&("max"==s?r=i||1:1!=s?(a*=s,r=Math.min(a*h,i||1)):r=a*h,a=r/h),a=isNaN(a)?0:a,r=isNaN(r)?0:r,!i&&this.conf.fixItemSize){var c=e.width/e.height,d=(i=Math.max(e.width,e.height),this._scaleImageSize(t,{width:i,height:i},i));c<1?r=(a=d.height/e.height)*h/c:a=(r=d.width/e.width)/h*c;var m=100*a,f=100*r,g=(1-r)/2*100,u=(1-a)/c*100*(o?.5:1);return l.style.height=m+"%",t.reflection&&(t.reflection.style.height=m*this.conf.reflectionHeight+"%"),l.style.width=f+"%",t.reflection&&(t.reflection.style.width=f+"%"),l.style.marginLeft=g+"%",t.reflection&&(t.reflection.style.marginLeft=g+"%"),l.style.marginTop=u+"%",t.element.style.overflow="hidden",e}return{width:r,height:a}},_setItemSize:function(){if(ContentFlowGlobal.Browser.IE)var t=function(t,e){if(this.conf.fixItemSize){if(ContentFlowGlobal.Browser.IE6){var i=parseInt(t.content.style.height)/100;t.content.style.height=e.height*i+"px";var n=parseInt(t.content.style.marginTop)/100;t.content.style.marginTop=e.height*n+"px"}}else t.content.style.height=e.height+"px";if(t.reflection){i=parseInt(t.content.style.height);t.reflection.style.height=i*this.conf.reflectionHeight+"px",t.reflection.style.marginTop=i*this.conf.reflectionGap+"px"}t.element.style.width=e.width+"px",t.element.style.height=e.height*(1+this.conf.reflectionHeight+this.conf.reflectionGap)+"px"};else t=function(t,e){t.reflection?(t.element.style.height=e.height*(1+this.conf.reflectionHeight+this.conf.reflectionGap)+"px",t.reflection.style.marginTop=e.height*this.conf.reflectionGap+"px"):this._reflectionWithinImage?t.element.style.height=e.height*(1+this.conf.reflectionHeight+this.conf.reflectionGap)+"px":t.element.style.height=e.height+"px",t.element.style.width=e.width+"px"};return t}(),_setItemOpacity:function(){if(ContentFlowGlobal.Browser.IE6)var t=function(t){if(t.content.origSrc&&t.content.origSrc.match(/\.png$/)){var e=t.content.src;t.content.src=t.content.origSrc,t.content.style.filter=t.content.filterString+" progid:DXImageTransform.Microsoft.BasicImage(opacity="+t.opacity+")",t.content.src=e}else t.content.style.filter="progid:DXImageTransform.Microsoft.BasicImage(opacity="+t.opacity+")";t.reflection&&(t.reflection.style.filter=t.reflection.filterString+"progid:DXImageTransform.Microsoft.BasicImage(opacity="+t.opacity+")")};else if(ContentFlowGlobal.Browser.IE)t=function(t){t.element.style.filter="progid:DXImageTransform.Microsoft.BasicImage(opacity="+t.opacity+")"};else t=function(t){t.element.style.opacity=t.opacity};return t}()},Function.bind||(Function.prototype.bind=function(t){var e=this;return function(){return e.apply(t,arguments)}}),Math.erf2||(Math.erf2=function(t){var e=-8*(Math.PI-3)/(3*Math.PI*(Math.PI-4)),i=t*t;return 1-Math.pow(Math.E,-i*(4/Math.PI+e*i)/(1+e*i))}),Math._2PI05||(Math._2PI05=Math.sqrt(2*Math.PI)),Math.normDist||(Math.normDist=function(t,e,i){if(!e)e=1;if(!i)i=0;if(!t)t=-i;return 1/(e*Math._2PI05)*Math.pow(Math.E,-(t-i)*(t-i)/(2*e*e))}),Math.normedNormDist||(Math.normedNormDist=function(t,e,i){return this.normDist(t,e,i)/this.normDist(i,e,i)}),Math.exp||(Math.exp=function(t){return Math.pow(Math.E,t)}),Math.ln||(Math.ln=Math.log),Math.log2||(Math.log2=function(t){return Math.log(t)/Math.LN2}),Math.log10||(Math.log10=function(t){return Math.log(t)/Math.LN10}),Math.logerithm||(Math.logerithm=function(t,e){return e&&e!=Math.E?2==e?Math.log2(t):10==e?Math.log10(t):Math.log(t)/Math.log(e):Math.log(t)}),!Event)var Event={};Event.stop||(Event.stop=function(t){return t.cancelBubble=!0,t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),!1}),document.all&&!window.opera?window.$CF=function(t){return"string"==typeof t?window.$CF(document.getElementById(t)):(CFElement.prototype.extend&&t&&!t.extend&&CFElement.prototype.extend(t),t)}:window.$CF=function(t){return t},window.HTMLElement?CFElement=window.HTMLElement:(CFElement={},CFElement.prototype={},CFElement.prototype.extend=function(t){for(var e in this)t[e]||(t[e]=this[e])}),CFElement.findPos||(CFElement.prototype.findPos=function(){var t=this,e=curtop=0;try{if(t.offsetParent)for(e=t.offsetLeft,curtop=t.offsetTop;t=t.offsetParent;)e+=t.offsetLeft,curtop+=t.offsetTop}catch(t){}return{left:e,top:curtop}}),CFElement.getDimensions||(CFElement.prototype.getDimensions=function(){return{width:this.clientWidth,height:this.clientHeight}}),CFElement.hasClassName||(CFElement.prototype.hasClassName=function(t){return new RegExp("\\b"+t+"\\b").test(this.className)}),CFElement.addClassName||(CFElement.prototype.addClassName=function(t){this.hasClassName(t)||(this.className+=(this.className?" ":"")+t)}),CFElement.removeClassName||(CFElement.prototype.removeClassName=function(t){this.className=this.className.replace(new RegExp("\\b"+t+"\\b"),"").replace(/\s\s/g," ")}),CFElement.toggleClassName||(CFElement.prototype.toggleClassName=function(t){this.hasClassName(t)?this.removeClassName(t):this.addClassName(t)}),CFElement.getChildrenByClassName||(CFElement.prototype.getChildrenByClassName=function(t){for(var e=new Array,i=0;i<this.childNodes.length;i++){var n=this.childNodes[i];1==n.nodeType&&$CF(n).hasClassName(t)&&e.push(n)}return e}),CFElement.addEvent||(CFElement.prototype.addEvent=function(t,e,i){this.addEventListener?this.addEventListener(t,e,i):this.attachEvent("on"+t,e)}),CFElement.removeEvent||(CFElement.prototype.removeEvent=function(t,e,i){this.removeEventListener?this.removeEventListener(t,e,i):this.detachEvent("on"+t,e)}),window.addEvent||(window.addEvent=function(t,e,i){this.addEventListener?this.addEventListener(t,e,i):"load"!=t&&"resize"!=t?document.attachEvent("on"+t,e):this.attachEvent("on"+t,e)}),window.removeEvent||(window.removeEvent=function(t,e,i){this.removeEventListener?this.removeEventListener(t,e,i):"load"!=t&&"resize"!=t?document.detachEvent("on"+t,e):this.detachEvent("on"+t,e)}),ContentFlowGlobal.init();
